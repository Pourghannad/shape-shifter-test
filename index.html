<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shape Shifter</title>
  <style>
    body,
    html {
      overflow: hidden;
    }

    body {
      font-family: "Avenir", "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #666;
      font-size: 16px;
      line-height: 1.5em;
    }

    .body--ready {
      background: #0d2736;
    }

    a.copyright {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: #fff;
      font-size: 10px;
      opacity: .45;
    }

    .body--ready .social-media-container {
      position: absolute;
      top: 0;
      z-index: 1;
      width: 290px;
      height: 90px;
      left: 0;
      bottom: 0;
      right: 0;
      margin: auto;
      display: flex;
      opacity: 1;
      visibility: visible;
      align-items: center;
      justify-content: center;
      animation-name: socialMedia;
      animation-duration: 5.35s;
      animation-iteration-count: 1;
    }

    @keyframes socialMedia {
      0% {
        opacity: 0;
        visibility: hidden;
      }

      90% {
        opacity: 0;
        visibility: hidden;
      }

      100% {
        opacity: 1;
        visibility: visible;
        transform: translate3d(0px, 0px, 0px);
      }
    }

    .social-media-container a svg {
      width: 40px;
      height: 40px;
    }

    .social-media-container a {
      margin: 0 10px;
    }

    .social-media-container a svg path,
    .social-media-container a svg polygon {
      fill: #fff;
    }

    @media screen and (max-width: 500px) {
      .social-media-container a {
        margin: 0 5px;
      }

      .social-media-container a svg {
        width: 30px;
        height: 30px;
      }
    }
  </style>
</head>

<body>
  <canvas class="canvas"></canvas>
  <div class="social-media-container">
    <a target="_blank" href="https://www.linkedin.com/in/pourghannad">
      <svg width="24" height="24" viewBox="0 0 24 24">
        <path
          d="M6.80891 21.4996H2.81797V8.64761H6.80891V21.4996ZM4.81129 6.89449C3.53512 6.89449 2.5 5.83746 2.5 4.56129C2.5 3.9483 2.74351 3.36041 3.17696 2.92696C3.61041 2.49351 4.1983 2.25 4.81129 2.25C5.42428 2.25 6.01217 2.49351 6.44562 2.92696C6.87907 3.36041 7.12258 3.9483 7.12258 4.56129C7.12258 5.83746 6.08703 6.89449 4.81129 6.89449ZM21.7457 21.4996H17.7634V15.2433C17.7634 13.7523 17.7333 11.8402 15.6884 11.8402C13.6134 11.8402 13.2955 13.4601 13.2955 15.1359V21.4996H9.30883V8.64761H13.1365V10.4007H13.1923C13.7252 9.39097 15.0267 8.32535 16.9684 8.32535C21.0075 8.32535 21.75 10.9851 21.75 14.4398V21.4996H21.7457Z"
          fill="#0A66C2"></path>
      </svg>
    </a>
    <a target="_blank" href="https://twitter.com/pourghannad">
      <svg width="24" height="24" viewBox="0 0 24 24">
        <path
          d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
        </path>
      </svg>
    </a>
    <a target="_blank" href="https://www.instagram.com/pourghannad">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M12.0022 6.87225C9.16453 6.87225 6.87563 9.16166 6.87563 12C6.87563 14.8383 9.16453 17.1277 12.0022 17.1277C14.8399 17.1277 17.1288 14.8383 17.1288 12C17.1288 9.16166 14.8399 6.87225 12.0022 6.87225ZM12.0022 15.3337C10.1684 15.3337 8.66927 13.8387 8.66927 12C8.66927 10.1613 10.164 8.6663 12.0022 8.6663C13.8405 8.6663 15.3352 10.1613 15.3352 12C15.3352 13.8387 13.836 15.3337 12.0022 15.3337ZM18.5343 6.6625C18.5343 7.32746 17.9989 7.85853 17.3385 7.85853C16.6737 7.85853 16.1428 7.32299 16.1428 6.6625C16.1428 6.00201 16.6782 5.46647 17.3385 5.46647C17.9989 5.46647 18.5343 6.00201 18.5343 6.6625ZM21.9297 7.87638C21.8539 6.27424 21.488 4.85507 20.3146 3.68582C19.1456 2.51657 17.7267 2.15062 16.1249 2.07029C14.4741 1.97657 9.52593 1.97657 7.87507 2.07029C6.27775 2.14616 4.8589 2.51211 3.68544 3.68136C2.51199 4.85061 2.15059 6.26978 2.07027 7.87192C1.97658 9.52315 1.97658 14.4724 2.07027 16.1236C2.14612 17.7258 2.51199 19.1449 3.68544 20.3142C4.8589 21.4834 6.27328 21.8494 7.87507 21.9297C9.52593 22.0234 14.4741 22.0234 16.1249 21.9297C17.7267 21.8538 19.1456 21.4879 20.3146 20.3142C21.4835 19.1449 21.8494 17.7258 21.9297 16.1236C22.0234 14.4724 22.0234 9.52761 21.9297 7.87638ZM19.797 17.8953C19.449 18.7701 18.7752 19.4439 17.8963 19.7965C16.58 20.3186 13.4568 20.1981 12.0022 20.1981C10.5477 20.1981 7.41997 20.3142 6.1082 19.7965C5.23369 19.4484 4.55996 18.7745 4.20747 17.8953C3.68544 16.5788 3.80591 13.4549 3.80591 12C3.80591 10.5451 3.68991 7.41671 4.20747 6.10465C4.55549 5.22995 5.22922 4.55606 6.1082 4.2035C7.42443 3.68136 10.5477 3.80185 12.0022 3.80185C13.4568 3.80185 16.5845 3.68582 17.8963 4.2035C18.7708 4.5516 19.4445 5.22548 19.797 6.10465C20.319 7.42118 20.1985 10.5451 20.1985 12C20.1985 13.4549 20.319 16.5833 19.797 17.8953Z"
          fill="url(#paint0_radial)"></path>
        <defs>
          <radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
            gradientTransform="translate(2 22) rotate(-45) scale(28.2843)">
            <stop stop-color="#FFD353"></stop>
            <stop offset="0.318853" stop-color="#FB5247"></stop>
            <stop offset="0.618456" stop-color="#E63973"></stop>
            <stop offset="1" stop-color="#5F008F"></stop>
          </radialGradient>
        </defs>
      </svg>
    </a>
    <a target="_blank" href="https://github.com/pourghannad">
      <svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="32" height="32">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <a target="_blank" href="https://soundcloud.com/pourghannad">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3333.34 1447.66" shape-rendering="geometricPrecision"
        text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd">
        <defs>
          <linearGradient id="a" gradientUnits="userSpaceOnUse" x1="1649.01" y1=".02" x2="1649.01" y2="1447.48">
            <stop offset="0" stop-color="#f79810" />
            <stop offset="1" stop-color="#f8310e" />
          </linearGradient>
        </defs>
        <path
          d="M37.75 865.82c-6.95 0-12.48 5.38-13.37 13.05L.01 1064.02l24.37 181.96c.89 7.67 6.42 13.01 13.37 13.01 6.73 0 12.22-5.31 13.3-12.94v-.04.04l28.9-182.04-28.9-185.19c-1.04-7.61-6.61-12.99-13.3-12.99zm137.07-101.17c-1.15-7.95-6.84-13.44-13.87-13.44-7.06 0-12.91 5.67-13.87 13.44 0 .07-32.76 299.36-32.76 299.36l32.76 292.74c.93 7.85 6.77 13.51 13.87 13.51 6.99 0 12.69-5.52 13.83-13.44l37.29-292.8-37.24-299.36zm516.36-276.14c-13.44 0-24.55 11-25.2 24.98l-26.09 550.78 26.09 355.93c.68 13.92 11.76 24.88 25.2 24.88 13.37 0 24.44-11 25.24-24.96v.11l29.51-355.97-29.51-550.78c-.8-13.96-11.87-24.97-25.24-24.97zM423.93 679.94c-10.32 0-18.75 8.25-19.57 19.25l-29.4 364.94 29.4 353.07c.78 10.93 9.25 19.19 19.57 19.19 10.22 0 18.65-8.25 19.54-19.19l33.41-353.07-33.41-365.01c-.89-10.93-9.32-19.19-19.54-19.19zm538.84 765.11c16.66 0 30.21-13.44 30.9-30.65l25.59-349.95-25.57-733.26c-.68-17.21-14.22-30.65-30.91-30.65-16.81 0-30.4 13.48-30.93 30.69 0 .04-22.7 733.2-22.7 733.2l22.7 350.09c.54 17.06 14.12 30.54 30.91 30.54zm556 1.65c22.94 0 41.87-18.89 42.3-42.13v.26-.26l17.86-339.91-17.86-846.87c-.39-23.2-19.36-42.13-42.3-42.13-22.98 0-41.95 18.89-42.3 42.17l-15.95 846.55c0 .54 15.95 340.41 15.95 340.41.35 23.01 19.35 41.91 42.3 41.91zm-280.12-1.33c19.97 0 36.07-16.03 36.59-36.46v.26l21.72-344.64-21.74-738.59c-.54-20.43-16.64-36.42-36.59-36.42-20.11 0-36.2 15.99-36.64 36.42l-19.32 738.62 19.36 344.58c.42 20.21 16.52 36.24 36.63 36.24zm-681.62-3.22c11.87 0 21.48-9.5 22.37-22.02l31.47-356.01-31.47-338.65c-.87-12.5-10.48-21.93-22.37-21.93-12.04 0-21.65 9.5-22.41 22.08l-27.71 338.52 27.71 355.97c.8 12.55 10.37 22.04 22.41 22.04zm-265.13-19.51c8.67 0 15.7-6.84 16.71-16.31l35.35-342.27-35.31-355.18c-1.04-9.5-8.06-16.35-16.75-16.35-8.78 0-15.81 6.88-16.7 16.35 0 .04-31.12 355.18-31.12 355.18l31.12 342.21c.85 9.5 7.89 16.38 16.7 16.38zM1378.17 313.65c-21.69 0-39.07 17.24-39.51 39.32l-17.64 711.61 17.64 342.42c.43 21.8 17.78 39.04 39.51 39.04 21.65 0 38.93-17.21 39.43-39.29v.28l19.8-342.42-19.8-711.71c-.5-22-17.78-39.25-39.43-39.25zM826.46 1445.77c14.98 0 27.35-12.22 28.07-27.81l27.53-353.57-27.53-676.74c-.76-15.63-13.09-27.81-28.07-27.81-15.13 0-27.46 12.22-28.1 27.81 0 .04-24.37 676.74-24.37 676.74l24.42 353.71c.61 15.46 12.94 27.68 28.06 27.68zm307.44-33.37v-.18l23.66-347.73-23.66-757.97c-.57-18.82-15.42-33.59-33.74-33.59-18.43 0-33.26 14.73-33.76 33.59l-21 757.94 21.04 347.91c.5 18.64 15.34 33.37 33.74 33.37 18.36 0 33.13-14.73 33.74-33.48l-.01.13zm1789.47-784.83c-56.17 0-109.78 11.37-158.59 31.84C2732.15 289.89 2422.28.01 2044.3.01c-92.48 0-182.65 18.21-262.26 49.01-30.93 11.98-39.19 24.31-39.47 48.22v1301.29c.33 25.09 19.8 46 44.28 48.46 1.04.11 1129.18.68 1136.49.68 226.41 0 409.99-183.58 409.99-410.03 0-226.45-183.55-410.07-409.96-410.07zM1658.76 96.09c-24.63 0-44.85 20.22-45.2 45.07l-18.5 923.63L1613.6 1400c.33 24.48 20.54 44.67 45.17 44.67 24.55 0 44.78-20.19 45.13-45.02v.39l20.11-335.25-20.12-923.7c-.37-24.77-20.58-45-45.13-45z"
          fill="url(#a)" fill-rule="nonzero" />
      </svg>
    </a>
    <a target="_blank" href="https://open.spotify.com/user/talebigroup">
      <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd"
        clip-rule="evenodd">
        <path
          d="M19.098 10.638c-3.868-2.297-10.248-2.508-13.941-1.387-.593.18-1.22-.155-1.399-.748-.18-.593.154-1.22.748-1.4 4.239-1.287 11.285-1.038 15.738 1.605.533.317.708 1.005.392 1.538-.316.533-1.005.709-1.538.392zm-.126 3.403c-.272.44-.847.578-1.287.308-3.225-1.982-8.142-2.557-11.958-1.399-.494.15-1.017-.129-1.167-.623-.149-.495.13-1.016.624-1.167 4.358-1.322 9.776-.682 13.48 1.595.44.27.578.847.308 1.286zm-1.469 3.267c-.215.354-.676.465-1.028.249-2.818-1.722-6.365-2.111-10.542-1.157-.402.092-.803-.16-.895-.562-.092-.403.159-.804.562-.896 4.571-1.045 8.492-.595 11.655 1.338.353.215.464.676.248 1.028zm-5.503-17.308c-6.627 0-12 5.373-12 12 0 6.628 5.373 12 12 12 6.628 0 12-5.372 12-12 0-6.627-5.372-12-12-12z" />
      </svg>
    </a>
    <a target="_blank" href="mailto:mhpourghannad@gmail.com">
      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M22,19H2V5H22ZM4,17H20V7H4Z" />
        <polygon points="12 13.25 3.4 6.8 4.6 5.2 12 10.75 19.4 5.2 20.6 6.8 12 13.25" />
      </svg>
    </a>
  </div>
  <a target="_blank" href="http://www.kennethcachia.com" class="copyright">A canvas experiment by Kenneth Cachia</a>
  <script>
    /*
          Shape Shifter
          =============
          A canvas experiment by Kenneth Cachia
          http://www.kennethcachia.com
    
          Updated code
          ------------
          https://github.com/kennethcachia/Shape-Shifter 
    */

    var FONT_SIZE = 500,
      FONT_FAMILY = "Avenir, Helvetica Neue, Helvetica, Arial, sans-serif",
      // DRAW_CIRCLE_MULTIPLIER_PI = Math.floor(Math.random() * (4 * 100 - 1 * 100) + 1 * 100) / (1 * 100);
      DRAW_CIRCLE_MULTIPLIER_PI = 2,
      DRAW_CIRCLE_MULTIPLIER_Z = 0.2,
      SHAPE_GAP = 5;


    var S = {
      init: function () {
        S.Drawing.init(".canvas");
        document.body.classList.add("body--ready");

        S.UI.simulate("Pourghannad|Front-End Developer||");

        S.Drawing.loop(function () {
          S.Shape.render();
        });
      },
    };

    S.Drawing = (function () {
      var canvas, context, renderFn;
      requestFrame =
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function (callback) {
          window.setTimeout(callback, 1000 / 60);
        };

      return {
        init: function (el) {
          canvas = document.querySelector(el);
          context = canvas.getContext("2d");
          this.adjustCanvas();

          window.addEventListener("resize", function (e) {
            S.Drawing.adjustCanvas();
          });
        },

        loop: function (fn) {
          renderFn = !renderFn ? fn : renderFn;
          this.clearFrame();
          renderFn();
          requestFrame.call(window, this.loop.bind(this));
        },

        adjustCanvas: function () {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        },

        clearFrame: function () {
          context.clearRect(0, 0, canvas.width, canvas.height);
        },

        getArea: function () {
          return { w: canvas.width, h: canvas.height };
        },

        drawCircle: function (p, c) {
          context.fillStyle = c.render();
          context.beginPath();
          context.arc(p.x, p.y, p.z * DRAW_CIRCLE_MULTIPLIER_Z, 0, DRAW_CIRCLE_MULTIPLIER_PI * Math.PI, true);
          context.closePath();
          context.fill();
        },
      };
    })();

    S.UI = (function () {
      var canvas = document.querySelector(".canvas"),
        interval,
        isTouch = false, //('ontouchstart' in window || navigator.msMaxTouchPoints),
        currentAction,
        resizeTimer,
        time,
        maxShapeSize = 30,
        firstAction = true,
        sequence = [],
        cmd = "#";

      function formatTime(date) {
        var h = date.getHours(),
          m = date.getMinutes(),
          m = m < 10 ? "0" + m : m;
        return h + ":" + m;
      }

      function getValue(value) {
        return value && value.split(" ")[1];
      }

      function getAction(value) {
        value = value && value.split(" ")[0];
        return value && value[0] === cmd && value.substring(1);
      }

      function timedAction(fn, delay, max, reverse) {
        clearInterval(interval);
        currentAction = reverse ? max : 1;
        fn(currentAction);

        if (
          !max ||
          (!reverse && currentAction < max) ||
          (reverse && currentAction > 0)
        ) {
          interval = setInterval(function () {
            currentAction = reverse ? currentAction - 1 : currentAction + 1;
            fn(currentAction);

            if (
              (!reverse && max && currentAction === max) ||
              (reverse && currentAction === 0)
            ) {
              clearInterval(interval);
            }
          }, delay);
        }
      }

      function reset(destroy) {
        clearInterval(interval);
        sequence = [];
        time = null;
        destroy && S.Shape.switchShape(S.ShapeBuilder.letter(""));
      }

      function performAction(value) {
        var action, value, current;
        sequence =
          typeof value === "object"
            ? value
            : sequence.concat(value.split("|"));

        timedAction(
          function (index) {
            current = sequence.shift();
            action = getAction(current);
            value = getValue(current);

            switch (action) {
              case "countdown":
                value = parseInt(value) || 10;
                value = value > 0 ? value : 10;

                timedAction(
                  function (index) {
                    if (index === 0) {
                      if (sequence.length === 0) {
                        S.Shape.switchShape(S.ShapeBuilder.letter(""));
                      } else {
                        performAction(sequence);
                      }
                    } else {
                      S.Shape.switchShape(S.ShapeBuilder.letter(index), true);
                    }
                  },
                  1000,
                  value,
                  true
                );
                break;

              case "rectangle":
                value = value && value.split("x");
                value =
                  value && value.length === 2
                    ? value
                    : [maxShapeSize, maxShapeSize / 2];

                S.Shape.switchShape(
                  S.ShapeBuilder.rectangle(
                    Math.min(maxShapeSize, parseInt(value[0])),
                    Math.min(maxShapeSize, parseInt(value[1]))
                  )
                );
                break;

              case "circle":
                value = parseInt(value) || maxShapeSize;
                value = Math.min(value, maxShapeSize);
                S.Shape.switchShape(S.ShapeBuilder.circle(value));
                break;

              case "time":
                var t = formatTime(new Date());

                if (sequence.length > 0) {
                  S.Shape.switchShape(S.ShapeBuilder.letter(t));
                } else {
                  timedAction(function () {
                    t = formatTime(new Date());
                    if (t !== time) {
                      time = t;
                      S.Shape.switchShape(S.ShapeBuilder.letter(time));
                    }
                  }, 1000);
                }
                break;

              default:
                S.Shape.switchShape(
                  S.ShapeBuilder.letter(
                    current[0] === cmd ? "What?" : current
                  )
                );
            }
          },
          2000,
          sequence.length
        );
      }

      function init() {
        isTouch && document.body.classList.add("touch");
      }

      // Init
      init();

      return {
        simulate: function (action) {
          performAction(action);
        },
      };
    })();

    S.Point = function (args) {
      this.x = args.x;
      this.y = args.y;
      this.z = args.z;
      this.a = args.a;
      this.h = args.h;
    };

    S.Color = function (r, g, b, a) {
      this.r = r;
      this.g = g;
      this.b = b;
      this.a = a;
    };

    S.Color.prototype = {
      render: function () {
        return (
          "rgba(" + this.r + "," + +this.g + "," + this.b + "," + this.a + ")"
        );
      },
    };

    S.Dot = function (x, y) {
      this.p = new S.Point({
        x: x,
        y: y,
        z: 5,
        a: 1,
        h: 0,
      });

      this.e = 0.07;
      this.s = true;

      this.c = new S.Color(255, 255, 255, this.p.a);

      this.t = this.clone();
      this.q = [];
    };

    S.Dot.prototype = {
      clone: function () {
        return new S.Point({
          x: this.x,
          y: this.y,
          z: this.z,
          a: this.a,
          h: this.h,
        });
      },

      _draw: function () {
        this.c.a = this.p.a;
        S.Drawing.drawCircle(this.p, this.c);
      },

      _moveTowards: function (n) {
        var details = this.distanceTo(n, true),
          dx = details[0],
          dy = details[1],
          d = details[2],
          e = this.e * d;

        if (this.p.h === -1) {
          this.p.x = n.x;
          this.p.y = n.y;
          return true;
        }

        if (d > 1) {
          this.p.x -= (dx / d) * e;
          this.p.y -= (dy / d) * e;
        } else {
          if (this.p.h > 0) {
            this.p.h--;
          } else {
            return true;
          }
        }

        return false;
      },

      _update: function () {
        if (this._moveTowards(this.t)) {
          var p = this.q.shift();

          if (p) {
            this.t.x = p.x || this.p.x;
            this.t.y = p.y || this.p.y;
            this.t.z = p.z || this.p.z;
            this.t.a = p.a || this.p.a;
            this.p.h = p.h || 0;
          } else {
            if (this.s) {
              this.p.x -= Math.sin(Math.random() * 3.142);
              this.p.y -= Math.sin(Math.random() * 3.142);
            } else {
              this.move(
                new S.Point({
                  x: this.p.x + Math.random() * 50 - 25,
                  y: this.p.y + Math.random() * 50 - 25,
                })
              );
            }
          }
        }

        d = this.p.a - this.t.a;
        this.p.a = Math.max(0.1, this.p.a - d * 0.05);
        d = this.p.z - this.t.z;
        this.p.z = Math.max(1, this.p.z - d * 0.05);
      },

      distanceTo: function (n, details) {
        var dx = this.p.x - n.x,
          dy = this.p.y - n.y,
          d = Math.sqrt(dx * dx + dy * dy);

        return details ? [dx, dy, d] : d;
      },

      move: function (p, avoidStatic) {
        if (!avoidStatic || (avoidStatic && this.distanceTo(p) > 1)) {
          this.q.push(p);
        }
      },

      render: function () {
        this._update();
        this._draw();
      },
    };

    S.ShapeBuilder = (function () {
      var gap = SHAPE_GAP,
        shapeCanvas = document.createElement("canvas"),
        shapeContext = shapeCanvas.getContext("2d"),
        fontSize = FONT_SIZE,
        fontFamily = FONT_FAMILY;

      function fit() {
        shapeCanvas.width = Math.floor(window.innerWidth / gap) * gap;
        shapeCanvas.height = Math.floor(window.innerHeight / gap) * gap;
        shapeContext.fillStyle = "red";
        shapeContext.textBaseline = "middle";
        shapeContext.textAlign = "center";
      }

      function processCanvas() {
        var pixels = shapeContext.getImageData(
          0,
          0,
          shapeCanvas.width,
          shapeCanvas.height
        ).data;
        (dots = []),
          pixels,
          (x = 0),
          (y = 0),
          (fx = shapeCanvas.width),
          (fy = shapeCanvas.height),
          (w = 0),
          (h = 0);

        for (var p = 0; p < pixels.length; p += 4 * gap) {
          if (pixels[p + 3] > 0) {
            dots.push(
              new S.Point({
                x: x,
                y: y,
              })
            );

            w = x > w ? x : w;
            h = y > h ? y : h;
            fx = x < fx ? x : fx;
            fy = y < fy ? y : fy;
          }

          x += gap;

          if (x >= shapeCanvas.width) {
            x = 0;
            y += gap;
            p += gap * 4 * shapeCanvas.width;
          }
        }

        return { dots: dots, w: w + fx, h: h + fy };
      }

      function setFontSize(s) {
        shapeContext.font = "bold " + s + "px " + fontFamily;
      }

      function isNumber(n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
      }

      function init() {
        fit();
        window.addEventListener("resize", fit);
      }

      // Init
      init();

      return {
        imageFile: function (url, callback) {
          var image = new Image(),
            a = S.Drawing.getArea();

          image.onload = function () {
            shapeContext.clearRect(
              0,
              0,
              shapeCanvas.width,
              shapeCanvas.height
            );
            shapeContext.drawImage(this, 0, 0, a.h * 0.6, a.h * 0.6);
            callback(processCanvas());
          };

          image.onerror = function () {
            callback(S.ShapeBuilder.letter("What?"));
          };

          image.src = url;
        },

        circle: function (d) {
          var r = Math.max(0, d) / 2;
          shapeContext.clearRect(0, 0, shapeCanvas.width, shapeCanvas.height);
          shapeContext.beginPath();
          shapeContext.arc(r * gap, r * gap, r * gap, 0, 2 * Math.PI, false);
          shapeContext.fill();
          shapeContext.closePath();

          return processCanvas();
        },

        letter: function (l) {
          var s = 0;

          setFontSize(fontSize);
          s = Math.min(
            fontSize,
            (shapeCanvas.width / shapeContext.measureText(l).width) *
            0.8 *
            fontSize,
            (shapeCanvas.height / fontSize) *
            (isNumber(l) ? 1 : 0.45) *
            fontSize
          );
          setFontSize(s);

          shapeContext.clearRect(0, 0, shapeCanvas.width, shapeCanvas.height);
          shapeContext.fillText(
            l,
            shapeCanvas.width / 2,
            shapeCanvas.height / 2
          );

          return processCanvas();
        },

        rectangle: function (w, h) {
          var dots = [],
            width = gap * w,
            height = gap * h;

          for (var y = 0; y < height; y += gap) {
            for (var x = 0; x < width; x += gap) {
              dots.push(
                new S.Point({
                  x: x,
                  y: y,
                })
              );
            }
          }

          return { dots: dots, w: width, h: height };
        },
      };
    })();

    S.Shape = (function () {
      var dots = [],
        width = 0,
        height = 0,
        cx = 0,
        cy = 0;

      function compensate() {
        var a = S.Drawing.getArea();

        cx = a.w / 2 - width / 2;
        cy = a.h / 2 - height / 2;
      }

      return {
        shuffleIdle: function () {
          var a = S.Drawing.getArea();

          for (var d = 0; d < dots.length; d++) {
            if (!dots[d].s) {
              dots[d].move({
                x: Math.random() * a.w,
                y: Math.random() * a.h,
              });
            }
          }
        },

        switchShape: function (n, fast) {
          var size,
            a = S.Drawing.getArea();

          width = n.w;
          height = n.h;

          compensate();

          if (n.dots.length > dots.length) {
            size = n.dots.length - dots.length;
            for (var d = 1; d <= size; d++) {
              dots.push(new S.Dot(a.w / 2, a.h / 2));
            }
          }

          var d = 0,
            i = 0;

          while (n.dots.length > 0) {
            i = Math.floor(Math.random() * n.dots.length);
            dots[d].e = fast ? 0.25 : dots[d].s ? 0.14 : 0.11;

            if (dots[d].s) {
              dots[d].move(
                new S.Point({
                  z: Math.random() * 20 + 10,
                  a: Math.random(),
                  h: 18,
                })
              );
            } else {
              dots[d].move(
                new S.Point({
                  z: Math.random() * 5 + 5,
                  h: fast ? 18 : 30,
                })
              );
            }

            dots[d].s = true;
            dots[d].move(
              new S.Point({
                x: n.dots[i].x + cx,
                y: n.dots[i].y + cy,
                a: 1,
                z: 5,
                h: 0,
              })
            );

            n.dots = n.dots.slice(0, i).concat(n.dots.slice(i + 1));
            d++;
          }

          for (var i = d; i < dots.length; i++) {
            if (dots[i].s) {
              dots[i].move(
                new S.Point({
                  z: Math.random() * 20 + 10,
                  a: Math.random(),
                  h: 20,
                })
              );

              dots[i].s = false;
              dots[i].e = 0.04;
              dots[i].move(
                new S.Point({
                  x: Math.random() * a.w,
                  y: Math.random() * a.h,
                  a: 0.3, //.4
                  z: Math.random() * 4,
                  h: 0,
                })
              );
            }
          }
        },

        render: function () {
          for (var d = 0; d < dots.length; d++) {
            dots[d].render();
          }
        },
      };
    })();

    S.init();
  </script>
</body>

</html>